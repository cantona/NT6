// changquan.c 太祖長拳

#include <ansi.h>
inherit SKILL;
string type() { return "martial"; }
string martialtype() { return "skill"; }

string *msg = ({
"只見$N身形一矮，大喝聲中一個『沖天炮』對準$n的鼻子呼地砸了過去",
"$N左手一分，右拳運氣，一招『拔草尋蛇』便往$n的$l招呼過去",
"$N右拳在$n面門一晃，左掌使了個『葉底偷桃』往$n的$l狠命一抓",
"$N步履一沉，左拳拉開，右拳帶風，一招『黑虎掏心』勢不可擋地擊向$n$l",
"只見$N拉開架式，一招『雙風貫耳』使得虎虎有風。底下卻飛起一腳踢向$n$l",
"$N打得興起，大喝一聲：看我這招『龍虎相交』！ \n左手往$n身後一抄，右拳便往$n面門砸了過去",
"$N拉開後弓步，雙掌使了個『如封似閉』往$n的$l一推",
"只見$N運足氣力，一連三拳擊向$n$l，力道一拳高過一拳！ \n這一招的名字還相當高雅，叫作『陽關三疊』",
"$N往後一縱，就勢使了個『老樹盤根』，右腿掃向$n的$l",
"$N一個轉身，左掌護胸，右掌反手使了個『獨劈華山』往$n當頭一劈",
"$N一招『雙抄封天』，下半身右腳撇步上前，雙手化掌，向前雙抄上擊$n的$l",
"$N身體向前衝出，一式『衝步雙掌』，雙手先抱回腰際後，再向前以雙撐掌直推而出",
"$N全身原步右轉，右手向右刁出，左手順勢護肩，『回首雙刁』抓向$n的$l",
"$N提起左腿，伸直右腿成獨立步站定，『魁星踢鬥』左腿順勢向前直蹬而出",
"$N一招『進步衝捶』，上右步至左腳旁，雙手以雙衝拳向$n直擊而出",
"$N出一式『弓步衝打』，左腳向左跨出，身體儘量壓低，拉回左手，右拳向前直擊而出",
"$N一式『拍案齊掌』，全身微向下坐，產生後拉之勢，收左手，右手化掌向前直壓而出",
"$N保持原弓箭步站定不動，『燕子抄水』右掌原地翻掌，左手以反掌由右掌上方直穿而出",
"$N出『扭步斷肘』，右步跟前，成玉環步蹲定，順勢收回左手，右手向前以平肘直扣而出",
"$N步法先右後左，連續上步，一式『雙採衝捶』右拳向$n的$l直擊而出",
"$N拉回右手，左手化拳向前直擊而出，同時『左衝右踢』右腿向前平踢而出",
"$N右腳向前落步，成馬步坐定，『馬式挑打』在左手收回腰際，右拳向右直擊而出",
"$N一式『英雄獨立』，右拳原地翻掌，左掌化刁手斜刁身後，全式一氣呵成，瞬間完成",
"$N一招『猛虎伏案』，右腿向前直鏟而出，成伏虎步坐定，雙手以反刁手刁定$n",
"$N一招『魁星獨立』伸直右腿，將重心坐於左腳上，隨著拔起之勢，右掌向$n直挑而出",
"$N原勢不動，一招『竄步偷心』快速竄前，提起右腿向前快踢，同時左掌向前平推而出",
"$N向前一招『雙龍探爪』，雙手變掌為爪，先右後左，連續向$n的$l擊出",
"$N向前一竄，『猛虎出洞』將左刁手向後回勾，與右刁手同置身後再刁撇而出",
"$N身體保持後刁手姿勢不變，『朝天一蹬』右腿伸直，向前以腿式直踢$n$l",
"$N來了個『虛步斷肘』，輕點地面成虛步坐定，右拳順勢向前反衝而上",
"$N右手化掌，『採手衝捶』向前圈採而出，又順勢拉回右手，將左拳向$n擊出",
"$N向前衝出三步，一式『三步行拳』雙拳先右後左，連續向$n直擊而出",
"$N一式『馬式挑打』，右腳向前落步成馬步坐定，左手收回腰際，右拳直擊而出",
"$N一招『斜步插花』微向右轉，成獨立步站定，同時右手化掌向$n探抓",
"$N左手由右掌上方直穿而出，這招『左穿雲手』直插$n的$l",
"$N右手由左掌上方直穿而出，一招『右穿雲手』插向$n的$l",
"$N向左後方跳出，一式『跳步斷肘』，右手化肘，向左面$n橫扣而出",
"$N出『截步雙崩』，右腿落步坐定，雙拳挑起，藉著擊胸之力向兩側崩擊而出",
"$N成丁字步，『落步盤花』左拳極力向上反穿而出，接著收回右掌，向下擊落",
"$N出一招『翻身平掌』，全身向左轉正，左手化刁手，右手以橫切掌向$n直切而出",
"$N一招『走馬活挾』，左右手同時以穿雲手向$n穿出，連環三式",
"$N一式『回馬橫擂』，左腿向前踢出雙飛腿，同時左手回勾，右手前穿拍向$n",
"$N雙手右甩左手護肩，一式『回挑衝拳』右手曲肘上架，左拳向$n$l直擊而出",
"$N保持原弓箭步站定不動，一招『順步採手』，雙手以小纏手向上圈採",
"$N撐直左腿步法下壓，『窩肚衝捶』雙手順勢以窩肚捶向$n$l直推而出",
"$N左手圈封而回護住右肩，一招『翻天劈地』右手以鑽拳向$n穿打而出",
"$N身體向上挑起，出『馬式挑捶』在右手收回腰際之時左拳向$n直擊而出",
"$N右腿向前以小掃腿向前掃出，雙手握拳『泰山壓頂』直壓向$n的$l",
"$N右掌由後向前反挑而上，然後出『翻江走海』雙手向兩側以雙抄掌壓落",
"$N出『回步雙切』，身體後仰，雙手同時向前雙抄而上，打向$n的$l",
"$N身體右傾，一招『反身插花』，左掌不動，右掌向右下方反切$n$l",
"$N一式『翻天雙風』，雙手以雙抄掌向前反切而出，於面前硬碰，發出聲音",
"$N右腿向前直踢而出，『翻手箭彈』接着雙掌內翻，右手化掌，左手刁扣$n",
"$N左刁手不動，右掌收回胸前續勁，『順勢推山』以立掌向$n直推而出",
"$N收回雙手，以十字手封住胸前，『拗步聽風』接着雙掌向$n平撐而出",
"$N一招『枴子腿法』，全身向上撐起，左腿順勢向左橫踢$n的$l",
"$N伸直右腿，將重心坐於左腳上，『魁星獨立』隨著拔起之勢，右掌向前直挑而出",
"$N一式『走回馬槍』，雙手右甩，左手護肩，右手極力下甩又直挑而上",
});
string main_skill() { return "baihua-cuoquan"; }

int valid_enable(string usage)
{
        return usage == "cuff" || usage == "unarmed" || usage == "parry";
}

int valid_combine(string combo) { return combo=="sanshou"; }

mapping query_action(object me, object weapon)
{
        return ([
                "action" : msg[random(sizeof(msg))],
                "dodge"  : 40+random(20),
                "parry"  : -20+random(20),
                "force"  : 50+random(150),
                "damage_type" : random(2)?"內傷":"瘀傷",
        ]);
}
int valid_learn(object me)
{
        int lv = me->query_skill("changquan", 1);

        if (me->query_skill("baihua-cuoquan", 1) > 0)
                return notify_fail("你已經練成了百花錯拳，不必再單獨學習。\n");

        if( query_temp("weapon", me) || query_temp("secondary_weapon", me) )
                return notify_fail("練太祖長拳必須空手。\n");

        if (me->query_skill("unarmed", 1) < lv
           && me->query_skill("cuff", 1) < lv)
                return notify_fail("你拳腳與拳法均火候不足，無法領會更高"
                                   "深的太祖長拳。\n");

        return 1;
}
int practice_skill(object me)
{
        if( query("jing", me)<30 )
                return notify_fail("你的精神無法集中了，休息一下再練吧。\n");
        if( query("qi", me)<30 )
                return notify_fail("你現在手足痠軟，休息一下再練吧。\n");
        if( query("neili", me)<10 )
                return notify_fail("你的內力不夠了。\n");

        me->receive_damage("qi", 30);
        addn("neili", -10, me);

        return 1;
}
int learn_bonus() { return 30; }
int practice_bonus() { return 30; }
int success() { return 20; }
int power_point(object me) { return 1.0; }
string perform_action_file(string action)
{
        return __DIR__"changquan/" + action;
}

int help(object me)
{
        write(HIC"\n太祖長拳："NOR"\n");
        write(@HELP

    太祖長拳是冷氏家傳拳技。冷氏先祖為明朝武職左參遊擊將軍，
明亡後挾技隱居民間，肆機反清復明（有其家譜為證），其後人曾為
乾隆、嘉慶兩朝皇帝的待衞（有石碑為證）。此拳因其家族保守，不
允許其它拳種有丁點滲入，也不允許族人任意改動，故保持了原始的
風貌，傳至我處已歷二十三世。此拳在《紀效新書》、《陣記》、
《少林拳譜》、《玄機祕授穴道拳訣》等許多古代拳譜中均有記載，
但由於其先輩懷珍自祕，故社會傳習較少，現社會中會“太祖四進長拳
”者頗多，但完整繼承此拳種的人卻寥若星辰。

    太祖長拳的主要內容有：
    一、拳術類：太祖四進長拳（含拳譜）、六路捶（一路白馬圈向
<含拳譜>/二路葉裏藏花<含拳譜>/三路三把/四路八個字<含拳譜>/五
路斬拿捶/六路燕青靠）
    二、器械類：五路太祖卧龍刀/太祖雙刀/太祖花槍（含拳譜）/
穿林槍（含拳譜）/太祖騰蛇棍/十合大棒（含拳譜）/雙合棍（枴子）
/二女爭夫棍（三人對練）/桃園棍（趙匡胤、盧鎮恩、陶三春對練）
/太祖盤龍鞭（含拳譜）/流星捶（含拳譜）/春秋大刀（含拳譜）/竹
杆點大槍（出槍、活槍、三撲三蓋、捲簾槍）/金錢豹拿猴子（六人
對練）等。
    太祖長拳以實戰為主，拳勢多腿法，跌僕為主要攻擊手段，擒拿
為獨門絕技（均含破解之法，六路捶即為擒拿對練），用老拳師們的
話講就是“咱這拳裏有骨頭啃”，言下之意即是技擊價值很高。另外，
此拳有個不容忽視的重點，就是它的健身價值，其習練太祖長拳的老
拳師中，九十歲以上高齡者頗多，其中以第二十二世張玉華為最，享
年九十七歲。

        學習要求：
                無
HELP
        );
        return 1;
}