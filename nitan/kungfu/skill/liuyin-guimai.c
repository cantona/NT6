#include <ansi.h>
inherit FORCE;

mapping *action = ({
([      "name":   "六陰鬼脈﹒少商劍",
        "action": "$N雙手拇指同時捺出，嗤嗤兩聲急響，「" HIW "六陰鬼脈﹒少商劍" NOR "」有如石破"
                  "天驚、風雨大至",
        "force" : 560,
        "attack": 240,
        "dodge" : 190,
        "parry" : 190,
        "damage": 560,
        "weapon" : HIW "六陰鬼脈﹒少商劍氣" NOR,
        "damage_type":  "刺傷"
]),
([      "name":   "六陰鬼脈﹒少商劍",
        "action": "$N大拇指一按，嗤嗤兩指，勁道使得甚巧，「" HIW "六陰鬼脈﹒少商劍" NOR "」劍氣"
                  "如怒潮般湧至",
        "force" : 560,
        "attack": 240,
        "dodge" : 190,
        "parry" : 190,
        "damage": 560,
        "weapon" : HIW "六陰鬼脈﹒少商劍氣" NOR,
        "damage_type":  "刺傷"
]),
([      "name":   "六陰鬼脈﹒少商劍",
        "action": "$N大拇指連揮，「" HIW "六陰鬼脈﹒少商劍" NOR "」便如是一幅潑墨山水，縱橫倚斜"
                  "，劍路雄勁",
        "force" : 560,
        "attack": 240,
        "dodge" : 190,
        "parry" : 190,
        "damage": 560,
        "weapon" : HIW "六陰鬼脈﹒少商劍氣" NOR,
        "damage_type":  "刺傷"
]),
([      "name":   "六陰鬼脈﹒少商劍",
        "action": "$N雙手拇指同時捺出，「" HIW "六陰鬼脈﹒少商劍" NOR "」大開大闔，氣派宏偉，每"
                  "一劍都有風雨大至之勢",
        "force" : 560,
        "attack": 240,
        "dodge" : 190,
        "parry" : 190,
        "damage": 560,
        "weapon" : HIW "六陰鬼脈﹒少商劍氣" NOR,
        "damage_type":  "刺傷"
]),
([      "name":   "六陰鬼脈﹒商陽劍",
        "action": "$N食指連動，手腕園轉，「" HIW "六陰鬼脈﹒商陽劍" NOR "」一劍又一劍的刺出，輕"
                  "靈迅速，劍氣縱橫",
        "force" : 540,
        "attack": 245,
        "dodge" : 110,
        "parry" : 195,
        "damage": 580,
        "weapon" : HIW "六陰鬼脈﹒商陽劍氣" NOR,
        "damage_type":  "刺傷"
]),
([      "name":   "六陰鬼脈﹒商陽劍",
        "action": "$N變招奇速，右手食指疾從袖底穿出，「" HIW "六陰鬼脈﹒商陽劍" NOR "」登時幻出"
                  "無數指影",
        "force" : 540,
        "attack": 245,
        "dodge" : 110,
        "parry" : 195,
        "damage": 580,
        "weapon" : HIW "六陰鬼脈﹒商陽劍氣" NOR,
        "damage_type":  "刺傷"
]),
([      "name":   "六陰鬼脈﹒商陽劍",
        "action": "$N拇指一屈，食指隨即點出，嗤嗤兩聲急響，變成商陽劍法，「" HIW "六陰鬼脈﹒商"
                  "陽劍" NOR "」激射刺出",
        "force" : 540,
        "attack": 245,
        "dodge" : 110,
        "parry" : 195,
        "damage": 580,
        "weapon" : HIW "六陰鬼脈﹒商陽劍氣" NOR,
        "damage_type":  "刺傷"
]),
([      "name":   "六陰鬼脈﹒商陽劍",
        "action": "$N以食指急運「" HIW "六陰鬼脈﹒商陽劍" NOR "」之無形劍氣，卻不過是手指在數寸"
                  "范圍內一點一戳",
        "force" : 580,
        "attack": 245,
        "dodge" : 110,
        "parry" : 195,
        "damage": 580,
        "weapon" : HIW "六陰鬼脈﹒商陽劍氣" NOR,
        "damage_type":  "刺傷"
]),
([      "name":   "六陰鬼脈﹒中沖劍",
        "action": "$N右手中指一豎，「" HIW "六陰鬼脈﹒中沖劍" NOR "」向前刺出。真氣鼓盪，嗤然聲"
                  "響，無形劍氣直指$n",
        "force" : 560,
        "attack": 255,
        "dodge" : 110,
        "parry" : 170,
        "damage": 520,
        "weapon" : HIW "六陰鬼脈﹒中沖劍氣" NOR,
        "damage_type":  "刺傷"
]),
([      "name":   "六陰鬼脈﹒中沖劍",
        "action": "$N將中指向上一刺，「" HIW "六陰鬼脈﹒中沖劍" NOR "」拔地而起，接著手指向下一"
                  "劃，劍氣如利刀般砍出",
        "force" : 560,
        "attack": 245,
        "dodge" : 110,
        "parry" : 170,
        "damage": 520,
        "weapon" : HIW "六陰鬼脈﹒中沖劍氣" NOR,
        "damage_type":  "刺傷"
]),
([      "name":   "六陰鬼脈﹒中沖劍",
        "action": "電光火石之間，$N猛然翻掌，右手陡然探出，中指「" HIW "六陰鬼脈﹒中沖劍" NOR
                  "」向$n一豎",
        "force" : 560,
        "attack": 235,
        "dodge" : 110,
        "parry" : 170,
        "damage": 520,
        "weapon" : HIW "六陰鬼脈﹒中沖劍氣" NOR,
        "damage_type":  "刺傷"
]),
([      "name":   "六陰鬼脈﹒關沖劍",
        "action": "$N右手無名指伸出，「" HIW "六陰鬼脈﹒關沖劍" NOR "」劍路拙滯古樸，一股雄渾無"
                  "比的內力鼓盪而出",
        "force" : 530,
        "attack": 240,
        "dodge" : 100,
        "parry" : 195,
        "damage": 580,
        "weapon" : HIW "六陰鬼脈﹒關沖劍氣" NOR,
        "damage_type":  "刺傷"
]),
([      "name":   "六陰鬼脈﹒關沖劍",
        "action": "$N俯身斜倚，無名指「" HIW "六陰鬼脈﹒關沖劍" NOR "」彈射而出，指尖已對準$n發"
                  "出了一縷強烈的勁風",
        "force" : 530,
        "attack": 240,
        "dodge" : 100,
        "parry" : 195,
        "damage": 580,
        "weapon" : HIW "六陰鬼脈﹒關沖劍氣" NOR,
        "damage_type":  "刺傷"
]),
([      "name":   "六陰鬼脈﹒關沖劍",
        "action": "$N無名指輕輕一揮，「嗤啦」一聲，拙滯古樸的「" HIW "六陰鬼脈﹒關沖劍" NOR "」"
                  "劍氣向$n直射而出",
        "force" : 530,
        "attack": 240,
        "dodge" : 100,
        "parry" : 195,
        "damage": 580,
        "weapon" : HIW "六陰鬼脈﹒關沖劍氣" NOR,
        "damage_type":  "刺傷"
]),
([      "name":   "六陰鬼脈﹒少澤劍",
        "action": "$N左手小指一伸，一條氣流從少沖穴中激射而出，「" HIW "六陰鬼脈﹒少澤劍" NOR
                  "」出手入風，指向$n",
        "force" : 500,
        "attack": 260,
        "dodge" : 195,
        "parry" : 192,
        "damage": 570,
        "weapon" : HIW "六陰鬼脈﹒少澤劍氣" NOR,
        "damage_type":  "刺傷"
]),
([      "name":   "六陰鬼脈﹒少澤劍",
        "action": "忽見$N左手小指一伸，一條氣流從$P少沖穴中激射而出，一股「" HIW "六陰鬼脈﹒少"
                  "澤劍" NOR "」登時射向$n",
        "force" : 500,
        "attack": 260,
        "dodge" : 195,
        "parry" : 192,
        "damage": 570,
        "weapon" : HIW "六陰鬼脈﹒少澤劍氣" NOR,
        "damage_type":  "刺傷"
]),
([      "name":   "六陰鬼脈﹒少沖劍",
        "action": "$N右手小指伸出，真氣自少沖穴激盪而出，「" HIW "六陰鬼脈﹒少沖劍" NOR "」橫生"
                  "奇變，颼的刺向$n",
        "force" : 580,
        "attack": 250,
        "dodge" : 190,
        "parry" : 195,
        "damage": 540,
        "weapon" : HIW "六陰鬼脈﹒少沖劍氣" NOR,
        "damage_type":  "刺傷"
]),
([      "name":   "六陰鬼脈﹒少沖劍",
        "action": "$N掌托于胸前，伸出右小指，一招「" HIW "六陰鬼脈﹒少沖劍" NOR "」緩緩地點向$n"
                  "的周身大穴",
        "force" : 530,
        "attack": 270,
        "dodge" : 190,
        "parry" : 195,
        "damage": 560,
        "weapon" : HIW "六陰鬼脈﹒少沖劍氣" NOR,
        "damage_type":  "刺傷"
]),
([      "name":   "六陰鬼脈﹒少沖劍",
        "action": "$N小指一彈，「" HIW "六陰鬼脈﹒少沖劍" NOR "」化式「六陰鬼脈﹒分花拂柳」，劍勢如同柳絮"
                  "一般，飄而不亂",
        "force" : 530,
        "attack": 280,
        "dodge" : 190,
        "parry" : 195,
        "damage": 580,
        "weapon" : HIW "六陰鬼脈﹒少沖劍氣" NOR,
        "damage_type":  "刺傷"
]),
([      "name":   "六陰鬼脈﹒少沖劍",
        "action": "$N一招「" HIW "六陰鬼脈﹒少沖劍" NOR "」，劍氣回轉無定形，竟從左側繞了過來，"
                  "點向$n",
        "force" : 530,
        "attack": 280,
        "dodge" : 190,
        "parry" : 195,
        "damage": 540,
        "weapon" : HIW "六陰鬼脈﹒少沖劍氣" NOR,
        "damage_type":  "刺傷"
]),
([      "name":   "六陰鬼脈﹒少沖劍",
        "action": "$N右手小指一揮，一招「" HIW "六陰鬼脈﹒少沖劍" NOR "」點點刺刺破空刺出，宛如"
                  "雕花刺畫一般",
        "force" : 530,
        "attack": 280,
        "dodge" : 190,
        "parry" : 195,
        "damage": 580,
        "weapon" : HIW "六陰鬼脈﹒少沖劍氣" NOR,
        "damage_type":  "刺傷"
]),
});

mapping *action2 = ({
([      "name":   "六陰鬼脈﹒少商劍",
        "action": "$N雙手拇指同時捺出，嗤嗤兩聲急響，「" HIW "六陰鬼脈﹒少商劍" NOR "」有如石破"
                  "天驚、風雨大至",
        "force" : 480,
        "attack": 180,
        "dodge" : 120,
        "parry" : 120,
        "damage": 480,
        "weapon" : HIW "六陰鬼脈﹒少商劍氣" NOR,
        "damage_type":  "刺傷"
]),
([      "name":   "六陰鬼脈﹒少商劍",
        "action": "$N大拇指一按，嗤嗤兩指，勁道使得甚巧，「" HIW "六陰鬼脈﹒少商劍" NOR "」劍氣"
                  "如怒潮般湧至",
        "force" : 480,
        "attack": 180,
        "dodge" : 120,
        "parry" : 130,
        "damage": 480,
        "weapon" : HIW "六陰鬼脈﹒少商劍氣" NOR,
        "damage_type":  "刺傷"
]),
([      "name":   "六陰鬼脈﹒少商劍",
        "action": "$N大拇指連揮，「" HIW "六陰鬼脈﹒少商劍" NOR "」便如是一幅潑墨山水，縱橫倚斜"
                  "，劍路雄勁",
        "force" : 500,
        "attack": 170,
        "dodge" : 150,
        "parry" : 150,
        "damage": 490,
        "weapon" : HIW "六陰鬼脈﹒少商劍氣" NOR,
        "damage_type":  "刺傷"
]),
([      "name":   "六陰鬼脈﹒少商劍",
        "action": "$N雙手拇指同時捺出，「" HIW "六陰鬼脈﹒少商劍" NOR "」大開大闔，氣派宏偉，每"
                  "一劍都有風雨大至之勢",
        "force" : 490,
        "attack": 200,
        "dodge" : 160,
        "parry" : 160,
        "damage": 460,
        "weapon" : HIW "六陰鬼脈﹒少商劍氣" NOR,
        "damage_type":  "刺傷"
]),
([      "name":   "六陰鬼脈﹒商陽劍",
        "action": "$N食指連動，手腕園轉，「" HIW "六陰鬼脈﹒商陽劍" NOR "」一劍又一劍的刺出，輕"
                  "靈迅速，劍氣縱橫",
        "force" : 500,
        "attack": 215,
        "dodge" : 150,
        "parry" : 175,
        "damage": 500,
        "weapon" : HIW "六陰鬼脈﹒商陽劍氣" NOR,
        "damage_type":  "刺傷"
]),
([      "name":   "六陰鬼脈﹒商陽劍",
        "action": "$N變招奇速，右手食指疾從袖底穿出，「" HIW "六陰鬼脈﹒商陽劍" NOR "」登時幻出"
                  "無數指影",
        "force" : 480,
        "attack": 145,
        "dodge" : 110,
        "parry" : 125,
        "damage": 480,
        "weapon" : HIW "六陰鬼脈﹒商陽劍氣" NOR,
        "damage_type":  "刺傷"
]),
([      "name":   "六陰鬼脈﹒商陽劍",
        "action": "$N拇指一屈，食指隨即點出，嗤嗤兩聲急響，變成商陽劍法，「" HIW "六陰鬼脈﹒商"
                  "陽劍" NOR "」激射刺出",
        "force" : 440,
        "attack": 145,
        "dodge" : 110,
        "parry" : 115,
        "damage": 480,
        "weapon" : HIW "六陰鬼脈﹒商陽劍氣" NOR,
        "damage_type":  "刺傷"
]),
([      "name":   "六陰鬼脈﹒商陽劍",
        "action": "$N以食指急運「" HIW "六陰鬼脈﹒商陽劍" NOR "」之無形劍氣，卻不過是手指在數寸"
                  "范圍內一點一戳",
        "force" : 480,
        "attack": 125,
        "dodge" : 100,
        "parry" : 165,
        "damage": 480,
        "weapon" : HIW "六陰鬼脈﹒商陽劍氣" NOR,
        "damage_type":  "刺傷"
]),
([      "name":   "六陰鬼脈﹒中沖劍",
        "action": "$N右手中指一豎，「" HIW "六陰鬼脈﹒中沖劍" NOR "」向前刺出。真氣鼓盪，嗤然聲"
                  "響，無形劍氣直指$n",
        "force" : 460,
        "attack": 155,
        "dodge" : 80,
        "parry" : 70,
        "damage": 420,
        "weapon" : HIW "六陰鬼脈﹒中沖劍氣" NOR,
        "damage_type":  "刺傷"
]),
([      "name":   "六陰鬼脈﹒中沖劍",
        "action": "$N將中指向上一刺，「" HIW "六陰鬼脈﹒中沖劍" NOR "」拔地而起，接著手指向下一"
                  "劃，劍氣如利刀般砍出",
        "force" : 460,
        "attack": 145,
        "dodge" : 90,
        "parry" : 70,
        "damage": 440,
        "weapon" : HIW "六陰鬼脈﹒中沖劍氣" NOR,
        "damage_type":  "刺傷"
]),
([      "name":   "六陰鬼脈﹒中沖劍",
        "action": "電光火石之間，$N猛然翻掌，右手陡然探出，中指「" HIW "六陰鬼脈﹒中沖劍" NOR
                  "」向$n一豎",
        "force" : 460,
        "attack": 135,
        "dodge" : 100,
        "parry" : 70,
        "damage": 420,
        "weapon" : HIW "六陰鬼脈﹒中沖劍氣" NOR,
        "damage_type":  "刺傷"
]),
([      "name":   "六陰鬼脈﹒關沖劍",
        "action": "$N右手無名指伸出，「" HIW "六陰鬼脈﹒關沖劍" NOR "」劍路拙滯古樸，一股雄渾無"
                  "比的內力鼓盪而出",
        "force" : 530,
        "attack": 140,
        "dodge" : 100,
        "parry" : 195,
        "damage": 480,
        "weapon" : HIW "六陰鬼脈﹒關沖劍氣" NOR,
        "damage_type":  "刺傷"
]),
([      "name":   "六陰鬼脈﹒關沖劍",
        "action": "$N俯身斜倚，無名指「" HIW "六陰鬼脈﹒關沖劍" NOR "」彈射而出，指尖已對準$n發"
                  "出了一縷強烈的勁風",
        "force" : 500,
        "attack": 140,
        "dodge" : 100,
        "parry" : 195,
        "damage": 500,
        "weapon" : HIW "六陰鬼脈﹒關沖劍氣" NOR,
        "damage_type":  "刺傷"
]),
([      "name":   "六陰鬼脈﹒關沖劍",
        "action": "$N無名指輕輕一揮，「嗤啦」一聲，拙滯古樸的「" HIW "六陰鬼脈﹒關沖劍" NOR "」"
                  "劍氣向$n直射而出",
        "force" : 530,
        "attack": 140,
        "dodge" : 100,
        "parry" : 95,
        "damage": 520,
        "weapon" : HIW "六陰鬼脈﹒關沖劍氣" NOR,
        "damage_type":  "刺傷"
]),
([      "name":   "六陰鬼脈﹒少澤劍",
        "action": "$N左手小指一伸，一條氣流從少沖穴中激射而出，「" HIW "六陰鬼脈﹒少澤劍" NOR
                  "」出手入風，指向$n",
        "force" : 500,
        "attack": 160,
        "dodge" : 195,
        "parry" : 192,
        "damage": 520,
        "weapon" : HIW "六陰鬼脈﹒少澤劍氣" NOR,
        "damage_type":  "刺傷"
]),
([      "name":   "六陰鬼脈﹒少澤劍",
        "action": "忽見$N左手小指一伸，一條氣流從$P少沖穴中激射而出，一股「" HIW "六陰鬼脈﹒少"
                  "澤劍" NOR "」登時射向$n",
        "force" : 500,
        "attack": 160,
        "dodge" : 195,
        "parry" : 192,
        "damage": 520,
        "weapon" : HIW "六陰鬼脈﹒少澤劍氣" NOR,
        "damage_type":  "刺傷"
]),
([      "name":   "六陰鬼脈﹒少沖劍",
        "action": "$N右手小指伸出，真氣自少沖穴激盪而出，「" HIW "六陰鬼脈﹒少沖劍" NOR "」橫生"
                  "奇變，颼的刺向$n",
        "force" : 520,
        "attack": 150,
        "dodge" : 190,
        "parry" : 195,
        "damage": 520,
        "weapon" : HIW "六陰鬼脈﹒少沖劍氣" NOR,
        "damage_type":  "刺傷"
]),
([      "name":   "六陰鬼脈﹒少沖劍",
        "action": "$N掌托于胸前，伸出右小指，一招「" HIW "六陰鬼脈﹒少沖劍" NOR "」緩緩地點向$n"
                  "的周身大穴",
        "force" : 520,
        "attack": 170,
        "dodge" : 190,
        "parry" : 195,
        "damage": 520,
        "weapon" : HIW "六陰鬼脈﹒少沖劍氣" NOR,
        "damage_type":  "刺傷"
]),
([      "name":   "六陰鬼脈﹒少沖劍",
        "action": "$N小指一彈，「" HIW "六陰鬼脈﹒少沖劍" NOR "」化式「六陰鬼脈﹒分花拂柳」，劍勢如同柳絮"
                  "一般，飄而不亂",
        "force" : 520,
        "attack": 280,
        "dodge" : 190,
        "parry" : 195,
        "damage": 580,
        "weapon" : HIW "六陰鬼脈﹒少沖劍氣" NOR,
        "damage_type":  "刺傷"
]),
([      "name":   "六陰鬼脈﹒少沖劍",
        "action": "$N一招「" HIW "六陰鬼脈﹒少沖劍" NOR "」，劍氣回轉無定形，竟從左側繞了過來，"
                  "點向$n",
        "force" : 520,
        "attack": 180,
        "dodge" : 190,
        "parry" : 195,
        "damage": 520,
        "weapon" : HIW "六陰鬼脈﹒少沖劍氣" NOR,
        "damage_type":  "刺傷"
]),
([      "name":   "六陰鬼脈﹒少沖劍",
        "action": "$N右手小指一揮，一招「" HIW "六陰鬼脈﹒少沖劍" NOR "」點點刺刺破空刺出，宛如"
                  "雕花刺畫一般",
        "force" : 520,
        "attack": 180,
        "dodge" : 190,
        "parry" : 195,
        "damage": 580,
        "weapon" : HIW "六陰鬼脈﹒少沖劍氣" NOR,
        "damage_type":  "刺傷"
]),
});

int query_neili_improve(object me)
{
        int lvl;

        lvl = (int)me->query_skill("liuyin-guimai", 1);

        // 會六陰鬼脈
        if( query("special_skill/guimai", me) && query("scborn/ok", me) )
                return lvl * lvl * 15 * 25 / 100 / 200;

        return lvl * lvl * 15 * 18 / 100 / 200;
}

int valid_enable(string usage)
{
        return usage == "finger" || usage == "parry" || usage == "force";
}

int double_attack()
{
        return 1;
}

int valid_learn(object me)
{
        if( query_temp("weapon", me) || query_temp("secondary_weapon", me) )
                return notify_fail("練六陰鬼脈必須空手。\n");

        if( query("int", me)<36 )
                return notify_fail("你研究了半天，只感自己仍許多不明白之處，無法再作研究。\n");

        if( query("con", me)<36 )
                return notify_fail("你研究了一會兒，只覺得眼前金星亂冒，太陽穴突突的跳。\n");

        if( query("str", me)<34 )
                return notify_fail("你只覺得自己先天臂力不足，無法繼續修煉。\n");

        if( query("dex", me)<34 )
                return notify_fail("你只覺得自己身法不夠靈巧，無法繼續修煉。\n");

        if (me->query_skill("literate", 1) < 200)
                return notify_fail("你覺得六陰鬼脈極其深奧，不是你這種學問水平所能研究的。\n");

        if (me->query_skill("lamaism", 1) < 200)
                return notify_fail("你發現這裡面有很多奧妙都和密宗心法有關，難以理解。\n");

        if (me->query_skill("buddhism", 1) < 200)
                return notify_fail("你發現這裡面有很多奧妙都和禪宗心法有關，難以理解。\n");

        if (me->query_skill("jingluo-xue", 1) < 200)
                return notify_fail("你發現這裡面有很多奧妙都和人體的經絡構造有關，難以理解。\n");

        if( query("max_neili", me)<6000 )
                return notify_fail("你的內力太弱，無法學六陰鬼脈。\n");

        if ((int)me->query_skill("finger", 1) < 200)
                return notify_fail("你的基本指法火候不夠。\n");

        if ((int)me->query_skill("force", 1) < (int)me->query_skill("liuyin-guimai", 1) + 10)
                return notify_fail("你的現在必須先提高你基本內功的水平。\n");

        if ((int)me->query_skill("finger", 1) < (int)me->query_skill("liuyin-guimai", 1) + 10)
                return notify_fail("你的現在必須先提高你基本指法的水平。\n");

        return 1;
}

string query_skill_name(int level)
{
        int i;
        for(i = sizeof(action); i > 0; i--)
                if(level >= action[i-1]["lvl"])
                        return action[i-1]["skill_name"];
}

int practice_skill(object me)
{
        return notify_fail("六陰鬼脈只能通過研究來提高熟練度。\n");
}

mixed hit_ob(object me, object victim, int damage_bonus, int i, int attack_time)
{
        string name;

        if (userp(me))
                attack_time = (int)(me->query_skill("liuyin-guimai", 1) / 50);
        else
                attack_time = (int)(me->query_skill("liuyin-guimai", 1) / 25);

        // 放寬NPC的攻擊力度
        if (userp(me) && attack_time > 6)
                attack_time = 6;

        if (! me->is_busy()
           && living(victim)
           && damage_bonus > 120
            && query("neili", me)>400
            && query_temp("action_flag", me) != 0
           && me->query_skill("martial-cognize", 1) >= 220
           && me->query_skill("liuyin-guimai", 1) >= 280
           && me->query_skill("jingluo-xue", 1) >= 200)
        {
                if (userp(me) && random(3) != 1)
                                return 0;

                // 避免在使用Pfm時訊息重復
                if( userp(me) && !query_temp("liuyin-guimai/hit_msg", me) )
                        message_vision(HIW "\n霎時間$N" HIW "只覺思緒狂湧，六陰鬼脈之神力蓄勢待發，登"
                                     "時十指紛彈，此去彼來，連綿無盡。\n" NOR, me, victim);

                if (userp(me))
                        me->start_busy(2 + random(attack_time));
                    else
                        me->start_busy(1);

                       addn("neili", -attack_time*50, me);

                for (i = 0; i < attack_time; i++)
                {
                        if (! me->is_fighting(victim))
                                break;
                        COMBAT_D->do_attack(me, victim, 0, 0);
                }
        }

           if (damage_bonus / 5 > victim->query_dex()
               && damage_bonus > 150
            && query("neili", me)>200
           && me->query_skill("martial-cognize", 1) >= 220
           && me->query_skill("liuyin-guimai", 1) >= 280
           && me->query_skill("jingluo-xue", 1) >= 200)
        {
                addn("neili", -50, me);

                if( query("special_skill/guimai", me) )
                        victim->receive_wound("qi", damage_bonus, me);

                else
                        victim->receive_wound("qi", (damage_bonus - 80) / 2, me);

                return random(2) ? HIR "你聽到「嗤啦」一聲輕響，臉上竟飛濺到了一些血滴"
                                   "！\n" NOR:

                                   HIR "你只聽「噗嗤」一聲輕響，一股血柱至$n" HIR "身上"
                                   "濺出！\n" NOR;
        }
        return 1;
}

mapping query_action(object me, object weapon)
{
        if( !undefinedp(query_temp("six-action", me)) )
                return action[query_temp("six-action", me)];

        if( random(15) == 1 && query("neili", me)>600 )
        {
                addn("neili", -300, me);
                return ([       "action": "$N縱身前撲，雙手拇指同時按出一記「" HIR "六陰鬼脈﹒少商劍" NOR
                                          "」，兩道無形劍氣破空而出逼向$n",
                                        "attack": 300,
                                "dodge" : 200,
                                "parry" : 200,
                                "damage": 300,
                                "force" : 600,
                                "weapon" : HIR "六陰鬼脈﹒無形劍氣" NOR,
                                "damage_type": "刺傷"
                        ]);
        } else
        if( random(15) == 1 && query("neili", me)>600 )
        {
                addn("neili", -300, me);
                return ([       "action": "$N雙手手指急速彈動，頓時「" HIR "六陰鬼脈﹒商陽劍" NOR "」和「"
                                          HIR "六陰鬼脈﹒中沖劍" NOR "」兩路劍法齊施，劍氣源源不斷湧向$n",
                                        "attack": 300,
                                "dodge" : 200,
                                "parry" : 200,
                                "damage": 300,
                                "force" : 600,
                                "weapon" : HIR "六陰鬼脈﹒無形劍氣" NOR,
                                "damage_type": "刺傷"
                        ]);
        } else
        if( random(15) == 1 && query("neili", me)>1000 )
        {
                addn("neili", -300, me);
                return ([       "action": "$N內息急轉，不斷催動真氣，「" HIR "六陰鬼脈" NOR "」"
                                          "奧妙無方，劍氣破空之聲驟響，盡數襲向$n",
                                        "attack": 300,
                                "dodge" : 200,
                                "parry" : 200,
                                "damage": 300,
                                "force" : 600,
                                "weapon" : HIR "六陰鬼脈﹒無形劍氣" NOR,
                                "damage_type": "刺傷"
                        ]);
        }
        if( query("special_skill/guimai", me) )
                return action[random(sizeof(action))];

        else
                return action2[random(sizeof(action))];
}

string query_parry_msg(object victim_weapon)
{
        switch (random(4))
        {
        case 0:
                return "$n隨意揮洒，道道六陰鬼脈劍氣縱橫交錯，宛若天網，$N唯有望洋興嘆，徒呼奈何。\n";
        case 1:
                return "$n不閃不避，一招六陰鬼脈﹒中沖劍直襲$N的胸前大穴，迫得$N只有回身自救。\n";
        case 2:
                return "$n六劍連出，六陰鬼脈劍氣回盪，直割得$N眉毛削落，臉面生通，再也不能前進半分！\n";
        default:
                return "$n一聲長笑，六陰鬼脈﹒無形劍氣四處散開，將$N層層裹住，惟有勉強支撐。才約略擺脫了$n的反擊。\n";
        }
}

int difficult_level()
{
        return 8000;
}

string perform_action_file(string action)
{
        return __DIR__"liuyin-guimai/perform/" + action; 
}

string exert_function_file(string action)
{
        return __DIR__"liuyin-guimai/exert/" + action;
}